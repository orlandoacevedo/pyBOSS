from PyBOSS.boss_calc import PyBOSSCalc

from PyBOSS.Tests.utils import allclose
from PyBOSS.Tests import FILE_TEST_CALC

import unittest


class Test_InitSolutes(unittest.TestCase):
    def test_calc(self):
        rsolv = 1.4
        radsa = [
            0.0, 0.0, 1.9923701352, 1.683693072, 1.9923701352, 1.9923701352, 1.9923701352,
            1.9923701352, 1.9923701352, 1.9923701352, 1.9923701352, 1.9923701352, 1.9923701352,
            1.38062831904, 1.38062831904, 1.38062831904, 1.38062831904, 1.38062831904,
            1.38062831904, 1.38062831904, 1.38062831904, 1.38062831904, 1.38062831904,
            1.38062831904, 1.38062831904
        ]
        asol = [
            [0,             -0.998937581,   -0.046083729    ],
            [-0.15332039,   -1.04447644,    0.941042945     ],
            [0,             0,              0               ],
            [0.195055886,   0.057935038,    -1.255833413    ],
            [0.300103815,   2.198518923,    -1.834854627    ],
            [1.301203709,   2.648104096,    -1.013138614    ],
            [0.989260823,   2.732155428,    0.389950723     ],
            [0.946170129,   0.611468604,    0.973757698     ],
            [0.608108925,   0.471861586,    2.368750107     ],
            [-1.240582863,  -0.569456353,   0.520376216     ],
            [-0.518012259,  -0.186632837,   2.741291311     ],
            [-1.445656529,  -0.658295018,   1.857115382     ],
            [-0.787209646,  -0.406162989,   4.183857006     ],
            [-0.761469478,  2.319200307,    -1.578814907    ],
            [0.492024757,   2.029405827,    -2.898525886    ],
            [2.350147271,   2.702319659,    -1.334839271    ],
            [1.766106616,   3.033608006,    1.096296578     ],
            [-0.038400911,  2.950036594,    0.700577986     ],
            [2.022130674,   0.59867918,     0.707125488     ],
            [1.315717009,   0.880934875,    3.107499065     ],
            [-2.367256827,  -1.104248749,   2.263725228     ],
            [-1.991712515,  -0.94808631,    -0.192487566    ],
            [-1.733653166,  0.061066376,    4.486298275     ],
            [0,             0,              4.833199759     ],
            [-0.875437537,  -1.477129078,   4.408725885     ]
        ]
        explist = []
        with open(FILE_TEST_CALC,'rt') as f:
            for line in f:
                lt = line.split()
                if 'RK,' in line:
                    explist.append(float(lt[3]))
                    explist.append(float(lt[4]))
                elif 'VJ,' in line:
                    explist.append(float(lt[4]))
                    explist.append(float(lt[5]))
        bc = PyBOSSCalc(radsa=radsa, rsolv=rsolv, asol=asol, debug=True)
        self.assertTrue(allclose(bc.mydebuglist, explist, 0.00001))

        exps = [
            0.0, 0.0, 6.22859, 22.68332, 13.10007, 13.54523, 12.97396, 0.0, 8.82903,
            13.40909, 4.00207, 13.54119, 18.08262, 16.25902, 25.72636, 25.59652, 19.29761,
            15.45122, 16.53436, 17.20189, 20.40942, 24.60378, 23.52066, 20.02174, 23.75791
        ]
        expv = [
            0.0, 0.0, 21.14253, 33.87084, 34.89533, 31.53122, 33.29407, 14.78065, 28.31839,
            33.19741, 16.16743, 31.82191, 40.13805, 20.47478, 27.6343, 27.72646, 22.79574,
            19.35353, 20.27177, 21.32029, 23.45232, 27.14287, 25.9161, 22.91716, 26.10174
        ]
        self.assertTrue(allclose(bc.s, exps, 0.00002))
        self.assertTrue(allclose(bc.v, expv, 0.00002))
        self.assertTrue(allclose(bc.asol, asol, 0.00001))


if __name__ == '__main__':
    unittest.main()



